(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{1104:function(e,t,s){Promise.resolve().then(s.bind(s,7252))},7252:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return E},dynamic:function(){return I}});var a=s(7437),r=s(2265),n=s(1994),l=s(3335);function i(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,l.m6)((0,n.W)(t))}function c(e){let t=new Date,s=t.getTime()-e.getTime();if(s<6e4)return"Just now";if(s<36e5){let e=Math.floor(s/6e4);return"".concat(e," minute").concat(e>1?"s":""," ago")}if(s<864e5){let e=Math.floor(s/36e5);return"".concat(e," hour").concat(e>1?"s":""," ago")}if(s<6048e5){let e=Math.floor(s/864e5);return"".concat(e," day").concat(e>1?"s":""," ago")}return e.toLocaleDateString("en-US",{month:"short",day:"numeric",year:e.getFullYear()!==t.getFullYear()?"numeric":void 0})}function o(e,t){return e.length<=t?e:e.substring(0,t)+"..."}var d=s(2369),u=s(8736),m=s(1047),x=s(6362);function h(e){var t,s,r,n,l;let{signal:h,className:p}=e,g=function(e){let t={slack:"\uD83D\uDCAC",transcript:"\uD83C\uDF99ï¸",document:"\uD83D\uDCC4",web_scrape:"\uD83C\uDF10",jira:"\uD83C\uDFAB",default:"\uD83D\uDCCC"};return t[e]||t.default}(h.source),f=function(e){let t={slack:"bg-purple-100 text-purple-800 border-purple-200",transcript:"bg-blue-100 text-blue-800 border-blue-200",document:"bg-green-100 text-green-800 border-green-200",web_scrape:"bg-orange-100 text-orange-800 border-orange-200",jira:"bg-red-100 text-red-800 border-red-200",default:"bg-gray-100 text-gray-800 border-gray-200"};return t[e]||t.default}(h.source);return(0,a.jsxs)("div",{className:i("rounded-lg border bg-white p-3 text-sm transition-shadow hover:shadow-md",p),children:[(0,a.jsx)("div",{className:"mb-2 flex items-start justify-between",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-lg",children:g}),(0,a.jsx)("span",{className:i("rounded px-2 py-0.5 text-xs font-medium border",f),children:h.source}),h.score&&(0,a.jsxs)("span",{className:"rounded bg-gray-100 px-2 py-0.5 text-xs text-gray-600",children:["Score: ",h.score.toFixed(2)]})]})}),(0,a.jsx)("p",{className:"mb-2 text-gray-700 leading-relaxed",children:o(h.snippet,200)}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-2 text-xs text-gray-500",children:[(null===(t=h.metadata)||void 0===t?void 0:t.channel_name)&&(0,a.jsx)("div",{className:"flex items-center gap-1",children:(0,a.jsxs)("span",{className:"font-medium",children:["#",h.metadata.channel_name]})}),(null===(s=h.metadata)||void 0===s?void 0:s.customer)&&(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(d.Z,{className:"h-3 w-3"}),(0,a.jsx)("span",{children:h.metadata.customer})]}),(null===(r=h.metadata)||void 0===r?void 0:r.title)&&(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(u.Z,{className:"h-3 w-3"}),(0,a.jsx)("span",{children:o(h.metadata.title,30)})]}),(null===(n=h.metadata)||void 0===n?void 0:n.competitor)&&(0,a.jsx)("div",{className:"flex items-center gap-1",children:(0,a.jsx)("span",{className:"font-medium",children:h.metadata.competitor})}),h.created_at&&(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(m.Z,{className:"h-3 w-3"}),(0,a.jsx)("span",{children:c(new Date(h.created_at))})]}),(null===(l=h.metadata)||void 0===l?void 0:l.url)&&(0,a.jsxs)("a",{href:h.metadata.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-1 text-blue-600 hover:text-blue-800",children:[(0,a.jsx)(x.Z,{className:"h-3 w-3"}),(0,a.jsx)("span",{children:"View source"})]})]})]})}var p=s(2252),g=s(2222),f=s(2135),y=s(875);function b(e){let{message:t,className:s}=e,[n,l]=(0,r.useState)(!1),o="user"===t.role,u=t.isError;return(0,a.jsxs)("div",{className:i("flex gap-3",o?"justify-end":"justify-start",s),children:[!o&&(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)("div",{className:i("flex h-8 w-8 items-center justify-center rounded-full",u?"bg-red-100":"bg-primary"),children:u?(0,a.jsx)(p.Z,{className:"h-5 w-5 text-red-600"}):(0,a.jsx)(g.Z,{className:"h-5 w-5 text-white"})})}),(0,a.jsxs)("div",{className:i("flex max-w-[80%] flex-col gap-2",o&&"items-end"),children:[(0,a.jsxs)("div",{className:i("rounded-lg px-4 py-3",o?"bg-primary text-white":u?"bg-red-50 text-red-900 border border-red-200":"bg-gray-100 text-gray-900"),children:[(0,a.jsx)("p",{className:"whitespace-pre-wrap break-words leading-relaxed",children:t.content}),!o&&void 0!==t.confidence&&!u&&(0,a.jsxs)("div",{className:"mt-2 flex items-center gap-2",children:[(0,a.jsxs)("span",{className:"text-xs text-gray-500",children:["Confidence: ",Math.round(100*t.confidence),"%"]}),t.sources&&t.sources.length>0&&(0,a.jsx)("button",{onClick:()=>l(!n),className:"flex items-center gap-1 text-xs text-blue-600 hover:text-blue-800",children:n?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(f.Z,{className:"h-3 w-3"}),"Hide sources"]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(y.Z,{className:"h-3 w-3"}),"Show ",t.sources.length," source",t.sources.length>1?"s":""]})})]})]}),!o&&t.sources&&t.sources.length>0&&n&&(0,a.jsxs)("div",{className:"flex w-full flex-col gap-2",children:[(0,a.jsx)("div",{className:"text-xs font-medium text-gray-500",children:"Supporting Sources:"}),t.sources.map((e,t)=>(0,a.jsx)(h,{signal:e},e.id||t))]}),(0,a.jsx)("span",{className:"text-xs text-gray-500",children:c(t.timestamp)})]}),o&&(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)("div",{className:"flex h-8 w-8 items-center justify-center rounded-full bg-gray-300",children:(0,a.jsx)(d.Z,{className:"h-5 w-5 text-gray-600"})})})]})}var v=s(5863),j=s(4743);function w(e){let{onSend:t,disabled:s=!1,placeholder:n="Ask a question about your product...",className:l}=e,[c,o]=(0,r.useState)(""),d=e=>{e.preventDefault(),c.trim()&&!s&&(t(c),o(""))};return(0,a.jsxs)("form",{onSubmit:d,className:i("flex items-end gap-2",l),children:[(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)("textarea",{value:c,onChange:e=>o(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),d(e))},placeholder:n,disabled:s,rows:1,className:i("w-full resize-none rounded-lg border border-gray-300 px-4 py-3","focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20","disabled:cursor-not-allowed disabled:bg-gray-100 disabled:text-gray-500","min-h-[52px] max-h-[200px]"),style:{height:"auto",overflowY:c.split("\n").length>3?"auto":"hidden"},onInput:e=>{let t=e.target;t.style.height="auto",t.style.height=Math.min(t.scrollHeight,200)+"px"}})}),(0,a.jsx)("button",{type:"submit",disabled:s||!c.trim(),className:i("flex h-[52px] w-[52px] items-center justify-center rounded-lg","bg-primary text-white transition-all","hover:bg-primary/90 active:scale-95","disabled:cursor-not-allowed disabled:bg-gray-300 disabled:text-gray-500"),children:s?(0,a.jsx)(v.Z,{className:"h-5 w-5 animate-spin"}):(0,a.jsx)(j.Z,{className:"h-5 w-5"})})]})}var N=s(2023),S=s(2489),C=s(3417);function k(e){let{apiClient:t,conversationId:s}=e,{messages:n,isLoading:l,error:i,sendMessage:c,clearError:o}=function(e){let{conversationId:t,apiClient:s}=e,[a,n]=(0,r.useState)([]),[l,i]=(0,r.useState)(!1),[c,o]=(0,r.useState)(t||crypto.randomUUID()),[d,u]=(0,r.useState)(null);(0,r.useEffect)(()=>{if(t){let e=s.getConversation(t);e&&(n(e.messages),o(e.id))}},[t,s]),(0,r.useEffect)(()=>{if(a.length>0){var e,t;let r={id:c,title:(null===(e=a[0])||void 0===e?void 0:e.content.substring(0,50))||"New Conversation",messages:a,created_at:new Date((null===(t=a[0])||void 0===t?void 0:t.timestamp)||Date.now()),updated_at:new Date};s.saveConversation(r)}},[a,c,s]);let m=(0,r.useCallback)(async(e,t)=>{if(!e.trim())return;let a={id:crypto.randomUUID(),role:"user",content:e.trim(),timestamp:new Date};n(e=>[...e,a]),i(!0),u(null);try{let a=await s.query(e,t),r={id:crypto.randomUUID(),role:"assistant",content:a.answer,sources:a.supporting_signals,confidence:a.confidence,timestamp:new Date};n(e=>[...e,r])}catch(t){console.error("Failed to send message:",t),u(t.message||"Failed to get response");let e={id:crypto.randomUUID(),role:"assistant",content:"Error: ".concat(t.message||"Failed to get response from the server"),timestamp:new Date,isError:!0};n(t=>[...t,e])}finally{i(!1)}},[s]);return{messages:a,isLoading:l,error:d,conversationId:c,sendMessage:m,startNewConversation:(0,r.useCallback)(()=>{n([]),o(crypto.randomUUID()),u(null)},[]),deleteMessage:(0,r.useCallback)(e=>{n(t=>t.filter(t=>t.id!==e))},[]),clearError:(0,r.useCallback)(()=>{u(null)},[])}}({apiClient:t,conversationId:s}),d=(0,r.useRef)(null),[u,m]=(0,r.useState)(0===n.length);(0,r.useEffect)(()=>{var e;null===(e=d.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[n]),(0,r.useEffect)(()=>{n.length>0&&m(!1)},[n]);let x=e=>{c(e)};return(0,a.jsxs)("div",{className:"flex h-full flex-col",children:[(0,a.jsx)("div",{className:"border-b bg-white px-6 py-4 shadow-sm",children:(0,a.jsx)("div",{className:"flex items-center justify-between",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"flex h-10 w-10 items-center justify-center rounded-lg bg-primary",children:(0,a.jsx)(N.Z,{className:"h-6 w-6 text-white"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-xl font-semibold text-gray-900",children:"PM Intelligence Assistant"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Ask questions about customer feedback, features, and opportunities"})]})]})})}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto bg-gray-50 px-6 py-4",children:[i&&(0,a.jsxs)("div",{className:"mb-4 flex items-center justify-between rounded-lg border border-red-200 bg-red-50 px-4 py-3 text-sm text-red-800",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(p.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:i})]}),(0,a.jsx)("button",{onClick:o,className:"text-red-600 hover:text-red-800","aria-label":"Dismiss error",children:(0,a.jsx)(S.Z,{className:"h-4 w-4"})})]}),u&&0===n.length&&(0,a.jsxs)("div",{className:"flex h-full flex-col items-center justify-center text-center",children:[(0,a.jsx)("div",{className:"mb-8 flex h-20 w-20 items-center justify-center rounded-full bg-primary/10",children:(0,a.jsx)(C.Z,{className:"h-10 w-10 text-primary"})}),(0,a.jsx)("h2",{className:"mb-2 text-2xl font-semibold text-gray-900",children:"Welcome to PM Intelligence"}),(0,a.jsx)("p",{className:"mb-8 max-w-md text-gray-600",children:"Ask questions about customer feedback, feature requests, opportunities, or competitor intelligence. I'll search across all your data sources to provide accurate answers."}),(0,a.jsxs)("div",{className:"w-full max-w-2xl",children:[(0,a.jsx)("p",{className:"mb-3 text-sm font-medium text-gray-700",children:"Quick actions:"}),(0,a.jsx)("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2",children:["What are the top customer issues?","Show me recent feedback about features","What are competitors doing?","List high-priority opportunities"].map((e,t)=>(0,a.jsx)("button",{onClick:()=>x(e),className:"rounded-lg border border-gray-200 bg-white px-4 py-3 text-left text-sm transition-all hover:border-primary hover:shadow-md",children:e},t))})]})]}),n.length>0&&(0,a.jsxs)("div",{className:"space-y-4",children:[n.map(e=>(0,a.jsx)(b,{message:e},e.id)),(0,a.jsx)("div",{ref:d})]}),l&&(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[(0,a.jsx)("div",{className:"h-2 w-2 animate-pulse rounded-full bg-gray-400"}),(0,a.jsx)("div",{className:"h-2 w-2 animate-pulse rounded-full bg-gray-400",style:{animationDelay:"0.2s"}}),(0,a.jsx)("div",{className:"h-2 w-2 animate-pulse rounded-full bg-gray-400",style:{animationDelay:"0.4s"}}),(0,a.jsx)("span",{children:"Thinking..."})]})]}),(0,a.jsxs)("div",{className:"border-t bg-white px-6 py-4",children:[(0,a.jsx)(w,{onSend:x,disabled:l,placeholder:"Ask a question about your product..."}),(0,a.jsx)("p",{className:"mt-2 text-xs text-gray-500",children:"Press Enter to send, Shift+Enter for new line. Sources will be cited automatically."})]})]})}var D=s(1897);let I="force-dynamic";function E(){let{apiClient:e}=(0,D.P)();return e?(0,a.jsx)("main",{className:"h-screen",children:(0,a.jsx)(k,{apiClient:e})}):null}},1897:function(e,t,s){"use strict";s.d(t,{x:function(){return d},P:function(){return o}});var a=s(7437),r=s(2265);class n{async query(e,t){let s=await fetch("".concat(this.baseUrl,"/api/agents/v1/query"),{method:"POST",headers:{"X-API-Key":this.apiKey,"Content-Type":"application/json"},body:JSON.stringify({query:e,...t})});if(!s.ok){let e=await s.text();throw Error("Query failed: ".concat(s.statusText," - ").concat(e))}return s.json()}async searchSignals(e,t){let s=new URLSearchParams({query:e});(null==t?void 0:t.source)&&s.append("source",t.source),(null==t?void 0:t.customer)&&s.append("customer",t.customer),(null==t?void 0:t.feature)&&s.append("feature",t.feature);let a=await fetch("".concat(this.baseUrl,"/api/agents/v1/signals?").concat(s),{headers:{"X-API-Key":this.apiKey}});if(!a.ok)throw Error("Search failed: ".concat(a.statusText));return a.json()}async getCustomerProfile(e){let t=await fetch("".concat(this.baseUrl,"/api/agents/v1/customer/").concat(encodeURIComponent(e)),{headers:{"X-API-Key":this.apiKey}});if(!t.ok)throw Error("Failed to get customer profile: ".concat(t.statusText));return t.json()}async getOpportunities(e){let t=new URLSearchParams;(null==e?void 0:e.limit)&&t.append("limit",e.limit.toString()),(null==e?void 0:e.minConfidence)&&t.append("minConfidence",e.minConfidence.toString());let s=await fetch("".concat(this.baseUrl,"/api/agents/v1/opportunities?").concat(t),{headers:{"X-API-Key":this.apiKey}});if(!s.ok)throw Error("Failed to get opportunities: ".concat(s.statusText));return s.json()}saveConversation(e){let t=this.getConversations(),s=t.findIndex(t=>t.id===e.id);s>=0?t[s]=e:t.push(e),localStorage.setItem("pm_conversations",JSON.stringify(t))}getConversations(){let e=localStorage.getItem("pm_conversations");if(!e)return[];try{return JSON.parse(e).map(e=>({...e,created_at:new Date(e.created_at),updated_at:new Date(e.updated_at),messages:e.messages.map(e=>({...e,timestamp:new Date(e.timestamp)}))}))}catch(e){return[]}}getConversation(e){return this.getConversations().find(t=>t.id===e)||null}deleteConversation(e){let t=this.getConversations().filter(t=>t.id!==e);localStorage.setItem("pm_conversations",JSON.stringify(t))}createEventStream(e,t){let s=new EventSource("".concat(this.baseUrl,"/api/agents/v1/events/stream?apiKey=").concat(this.apiKey));return s.addEventListener("signal.ingested",t=>{try{let s=JSON.parse(t.data);e({type:"signal.ingested",data:s})}catch(e){console.error("Failed to parse SSE event:",e)}}),s.addEventListener("extraction.corrected",t=>{try{let s=JSON.parse(t.data);e({type:"extraction.corrected",data:s})}catch(e){console.error("Failed to parse SSE event:",e)}}),s.onerror=e=>{console.error("SSE connection error:",e),t&&t(Error("SSE connection failed"))},s}async testConnection(){try{return(await fetch("".concat(this.baseUrl,"/api/health"),{headers:{"X-API-Key":this.apiKey}})).ok}catch(e){return!1}}constructor(e,t){this.apiKey=e,this.baseUrl=t||"http://localhost:3000"}}var l=s(5863),i=s(4001);let c=(0,r.createContext)({apiClient:null,apiKey:null,setApiKey:()=>{},clearApiKey:()=>{}});function o(){return(0,r.useContext)(c)}function d(e){let{children:t}=e,[s,i]=(0,r.useState)(null),[o,d]=(0,r.useState)(null),[m,x]=(0,r.useState)(!0),[h,p]=(0,r.useState)(null);(0,r.useEffect)(()=>{let e=localStorage.getItem("pm_api_key");if(e){i(e);let t=new n(e);d(t),t.testConnection().then(e=>{e||p("Failed to connect to API. Please check your API key."),x(!1)})}else x(!1)},[]);let g=e=>{localStorage.setItem("pm_api_key",e),i(e),d(new n(e)),p(null)},f=()=>{localStorage.removeItem("pm_api_key"),i(null),d(null)};return m?(0,a.jsx)("div",{className:"flex h-screen items-center justify-center",children:(0,a.jsx)(l.Z,{className:"h-8 w-8 animate-spin text-primary"})}):s&&o?h?(0,a.jsx)("div",{className:"flex h-screen items-center justify-center",children:(0,a.jsxs)("div",{className:"w-full max-w-md rounded-lg border border-red-200 bg-red-50 p-6 text-center",children:[(0,a.jsx)("p",{className:"mb-4 text-red-800",children:h}),(0,a.jsx)("button",{onClick:f,className:"rounded-lg bg-red-600 px-4 py-2 text-white hover:bg-red-700",children:"Try Different API Key"})]})}):(0,a.jsx)(c.Provider,{value:{apiClient:o,apiKey:s,setApiKey:g,clearApiKey:f},children:t}):(0,a.jsx)(u,{onLogin:g})}function u(e){let{onLogin:t}=e,[s,l]=(0,r.useState)(""),[c,o]=(0,r.useState)(""),d=async e=>{if(e.preventDefault(),!s.trim()){o("Please enter an API key");return}let a=new n(s);if(!await a.testConnection()){o("Invalid API key or unable to connect to server");return}t(s)};return(0,a.jsx)("div",{className:"flex h-screen items-center justify-center bg-gray-50",children:(0,a.jsxs)("div",{className:"w-full max-w-md rounded-lg border bg-white p-8 shadow-lg",children:[(0,a.jsxs)("div",{className:"mb-6 text-center",children:[(0,a.jsx)("div",{className:"mb-4 flex justify-center",children:(0,a.jsx)("div",{className:"flex h-16 w-16 items-center justify-center rounded-full bg-primary/10",children:(0,a.jsx)(i.Z,{className:"h-8 w-8 text-primary"})})}),(0,a.jsx)("h1",{className:"mb-2 text-2xl font-semibold text-gray-900",children:"PM Intelligence"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Enter your API key to get started"})]}),(0,a.jsxs)("form",{onSubmit:d,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"apiKey",className:"mb-2 block text-sm font-medium text-gray-700",children:"API Key"}),(0,a.jsx)("input",{id:"apiKey",type:"password",value:s,onChange:e=>{l(e.target.value),o("")},placeholder:"Enter your API key...",className:"w-full rounded-lg border border-gray-300 px-4 py-2 focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20"}),c&&(0,a.jsx)("p",{className:"mt-2 text-sm text-red-600",children:c})]}),(0,a.jsx)("button",{type:"submit",className:"w-full rounded-lg bg-primary px-4 py-2 text-white transition-colors hover:bg-primary/90",children:"Connect"})]}),(0,a.jsxs)("div",{className:"mt-6 text-center text-xs text-gray-500",children:[(0,a.jsx)("p",{children:"Don't have an API key?"}),(0,a.jsx)("p",{className:"mt-1",children:"Contact your administrator or check the backend API documentation."})]})]})})}}},function(e){e.O(0,[327,971,117,744],function(){return e(e.s=1104)}),_N_E=e.O()}]);